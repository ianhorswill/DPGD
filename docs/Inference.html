
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- generic metadata -->
	<title>Inference</title>
	<meta name="author" content="Ian Horswill">
	<meta name="description" content="An introduction to declarative programming with applications to vidoegames">
	<meta name="generator" content="Booker">

	<!-- seo helpers: generic, twitter, facebook/opengraph -->
	<meta itemprop="name" content="Inference">
	<meta name="twitter:title" content="Inference">
	<meta property="og:title" content="Inference" />
	<meta property="og:type" content="article" />
	<meta property="og:site_name" content="Declarative Programming for Game Designers" />
	
	<!-- stylesheets -->
	<!-- bootstrap needs to come first -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

	<!-- then our style sheet -->
	<link rel="stylesheet" href="site.css"> 

	<!-- sample fonts, please feel free to replace with your preferred ones -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Public+Sans:400,700&display=swap&subset=latin-ext"> 

	<!-- highlightjs is used for source code formatting inside <code> tags. feel free to remove it. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-dark.min.css">
	<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
	<script src="step.min.js"></script>
	<script>hljs.highlightAll();</script>
	
	<!-- use MathJax for latex rendering -->
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

	<!-- Use mermaid to render diagrams -->
	<script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
</head>

<body>
<div class="container-fluid shadow header">
	<h1 style="text-align: right;">Incomplete draft: do not cite!</h1>

	<div class="container">
		<div class="col-10 col-md-8 header-contents">
				<a class="backgroundlink" href="Part_I.html"> Part I </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Clairvoyant_programming.html"> Clairvoyant programming </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Logic_programming.html"> Simple logic programs </a>
			<h1><a class="simplelink" href="index.html">Inference</a></h1>
		</div>
	</div>
</div>

	<!-- Make clicking On Step code pop up a step interpreter and copy the code into the clipboard -->
	<script>
	document.querySelector("body").addEventListener('click', function(e) {
		var element = e.target.closest('code');
		if(element !== null && element.classList.contains('language-Step')) {
			var interp = window.open("https://ianhorswill.github.io/WebStep", "step");
			var handler = function(e) { 
				console.log(e.data);
				interp.postMessage(element.textContent, "*");
				window.removeEventListener('message', handler);
			};
			window.addEventListener('message', handler);
		}
	}, false);
	</script>



<div class="container-fluid">
	<div class="row justify-content-center">
		<div class="col-md-7 index-contents">

			<div class="container shadow blog-contents">

<h2 id="recap">Recap</h2>
<p>At this point, we have enough tools to let the computer do something that we might call “reasoning.”  We have predicates, which are tasks that answer questions by succeeding or failing.  We think of calling a predicate as asking a question.  For example, we might call <code>[Loves rover fluffy]</code>.  If it succeeds, the answer is yes: Rover loves Fluffy.  If it fails, then answer is no; poor Fluffy.</p>
<p>We can also ask “who/what” questions by passing in a variable and letting the predicate fill it in.  If we run the command <code>[Loves rover ?x]</code>, we’re effectively is asking “who does Rover love?”  If it succeeds and fills in a value for <code>?x</code>, then we know Rover loves whoever was filled in for <code>?x</code>.  Rover might love other characters too, but we at least know one of them.</p>
<h2 id="rules-for-reasoning">Rules for reasoning</h2>
<p>We’ve also seen how we can specify methods for predicates that are general rules about the truth of one predicate in terms of the truth of others.</p>
<p>For example, let's assume we've defined a predicate <code>Parent</code> so that <code>[Parent ?x ?y]</code> is true (succeeds) whenever <code>?x</code>’s parent is <code>?y</code>.  If we want to reason about sibling relationships, we don’t have to separately store who is a sibling of whom; we could derive that information from <code>Parent</code>:</p>
<pre><code class="language-step">[predicate]
Siblings ?a ?b: [Parent ?a ?parent] [Parent ?b ?parent]
</code></pre>
<p>As far as the computer is concerned, that’s just a rule that says “if trying to run <code>Siblings</code>, one way to do it is to first run <code>[Parent ?a ?parent]</code>, and if that succeeds, run <code>[Parent ?b ?parent]</code>”.</p>
<p>But another way of looking at it is that the method can only succeed if <code>?a</code> and <code>?b</code> have the same parent.  So we could read it as a rule that effectively says “people are siblings if they share a parent”.</p>
<p>This is a general technique we can use to write rules of the form “this is true if these things are also true.”  If we want to say A is true if B is true, we write:</p>
<pre><code class="language-step">[predicate]
A: [B]
</code></pre>
<p>If we want to say A is true when B, C, and D are all true, then we say:</p>
<pre><code class="language-step">[predicate]
A: [B] [C] [D]
</code></pre>
<p>If we want to say “A is true when either B is true or C and D are both true”, we can write two methods:</p>
<pre><code class="language-step">[predicate]
A: [B]
A: [C] [D]
</code></pre>
<p>If we add parameters to the rules, everything needs to match up as it would for any of the other code we’ve seen.</p>
<h2 id="reasoning-about-family-relationships">Reasoning about family relationships</h2>
<p>Let’s return to our definition of siblinghood:</p>
<pre><code class="language-step">[predicate]
Siblings ?a ?b: [Parent ?a ?parent] [Parent ?b ?parent]
</code></pre>
<p>It’s worth pointing out that under this definition, people are their own siblings.  If you call <code>[Siblings fred fred]</code>, it will first run <code>[Parent fred ?parent]</code>, which will succeed, assuming Fred has a parent, and then it will run it again, so it will presumably succeed again.  So it thinks Fred is his own sibling.  That might work for your purposes or not.  If you want to rule out self-siblinghood, you can just add an extra condition to the rule that requires <code>?a</code> and <code>?b</code> be different:</p>
<pre><code class="language-step">[predicate]
Siblings ?a ?b: [Parent ?a ?parent] [Parent ?b ?parent] [Different ?a ?b]
</code></pre>
<p>Here, <code>Different</code> just tests if its parameters are different.</p>
<p>Now we can start to define other relationships:</p>
<pre><code class="language-step">[predicate]
Grandparent ?c ?g: [Parent ?c ?p] [Parent ?p ?g]
</code></pre>
<p>Which says that <code>?g</code> is a grandparent of grandchild <code>?c</code> if <code>?p</code> is a parent of <code>?c</code>, and <code>?g</code> is a parent of <code>?p</code>.  Note that we’re just choosing the convention that the grandparent is the second parameter.  We could have chosen it to be the other way around; the computer doesn’t care.</p>
<p>Or we can say:</p>
<pre><code class="language-step">[predicate]
Aunt ?c ?a: [Parent ?c ?p] [Siblings ?p ?a]
</code></pre>
<p>Which says that the aunt of a child is the sibling of a parent of a child.  We haven’t been paying attention to gender in these definitions, but since there isn’t a good gender-neutral word for aunt-or-uncle, we’ll just say aunt.  If you want to track gender, then just add some predicates for Male and Female, and then add the predicate to the rule:</p>
<pre><code class="language-step">[predicate]
Aunt ?c ?a: [Parent ?c ?p] [Siblings ?p ?a] [Female ?a]
</code></pre>
<h2 id="self-referential-rules">Self-referential rules</h2>
<p>So far, so good.  We can define the Parent relationship and then define most everything else in terms of that: grandparents and grandchildren, great-grandparents, siblings, etc. But what about ancestors?  An ancestor is your parent or grandparent or great-grandparent or great, great-grandparent, etc. We could write:</p>
<pre><code class="language-step">[predicate]
Ancestor ?c ?a: [Parent ?c ?a]
Ancestor ?c ?g: [Grandparent ?c ?g]
Ancestor ?c ?g: [Greatgrandparent ?c ?g]
Ancestor ?c ?g: [Greatgreatgrandparent ?c ?g]
</code></pre>
<p>And so on, forever.  But forever is a lot of typing.  What we can say instead is: an ancestor is either your parent, or an ancestor of your parent.  That’s just two rules that do the equivalent work of an infinite number of rules:</p>
<pre><code class="language-step">[predicate]
Ancestor ?c ?p: [Parent ?c ?p]
Ancestor ?c ?a: [Parent ?c ?p] [Ancestor ?p ?a]
</code></pre>
<p>In mathematics, logic, and computer science, this is called a <strong>recursive</strong> definition, and when the <code>Ancestor</code> rule turns around and calls <code>Ancestor</code> again, that’s called <strong>recursion</strong>.</p>
<p>Recursive definitions have a fairly standard format.  They generally start with a rule that doesn’t recurse.  This is called a <strong>base case</strong>.  It notices when it can decide immediately without having to recurse.  Then there’s another rule that recurses, called unsurprisingly, the <strong>recursive case</strong>.  It’s important to have the base case first, and the recursive case second.  And for the recursive rule, you generally want to end with the recursive call, not start with it.
Why is that?  Because Step doesn’t really understand logic.  It’s just mechanically running the tasks you tell it to.  We’re just using our understanding of how it runs them to make it mimic logical inference.  By putting the base case first, we’re causing it to always check whether it really needs to recurse before recursing.  If we flip the order, it will always recurse no matter what.  That means the first call recurses, but then the recursive call recurses, and that call also recurses, on and on infinitely, without Step ever understanding that something’s wrong.</p>
<p>So if you rearrange things, it’s still conceptually correct from the standpoint of what it means to be an ancestor, but Step won’t be able to work with it.</p>
<h2 id="taxonomies">Taxonomies</h2>
<p>Taxonomic relationships come up a lot in games.  Dogs and cats are kinds of animals, Collie and Labrador are kinds of dogs.  We can express those relationships using rules:</p>
<pre><code class="language-Step"># Try: [Animal ?x]
[predicate]
Animal ?a: [Dog ?a]
Animal ?a: [Cat ?a]

[predicate]
Dog ?d: [Labrador ?d]
Dog ?d: [Collie ?d]

[predicate]
Collie lassie.
[predicate]
Labrador bruce.
</code></pre>
<p>Now suppose we run <code>[Animal lassie]</code>, i.e. we ask “is Lassie an animal?”  The system will start by running the first <code>Animal</code> method, which will call <code>Dog</code> to check if Lassie is a dog.  It then tries the first Dog method, which calls <code>Labrador</code> to check if Lassie is a Labrador.  That fails, since Bruce is the only Labrador.  So the system abandons the first <code>Dog</code> method and tries the second, which says to call <code>Collie</code>.  That succeeds, meaning it’s verified Lassie is a collie.  That then means that the method it was running for <code>Dog</code>, which had called Collie, also succeeds.  So the system has verified Lassie is a dog.  That then means that the method for <code>Animal</code> succeeds, and so it’s verified that Lassie is an animal.</p>
<p>We could instead have run <code>[Animal ?x]</code>, meaning “who’s an animal?”  It would then have run the first <code>Animal</code> rule, as before, but now it’s running <code>[Dog ?x]</code> rather than <code>[Dog lassie]</code>.  Then it will again start with the first <code>Dog</code> rule, which runs <code>[Labrador ?x]</code>.  Where the <code>Labrador</code> call failed in the <code>Lassie</code> example, it succeeds here because its parameter is a variable with no value.  So the call to <code>Labrador</code> actually succeeds, and binds <code>?x</code> to <code>bruce</code> (i.e. it sets <code>?x</code> to be <code>bruce</code> now).  Since <code>Labrador</code> succeeded, the <code>Dog</code> rule succeeds, which means the <code>Animal</code> rule succeeds, but in this case, it returns the answer that <code>?x=bruce</code>, i.e. “Bruce is an animal.”</p>
<p>Note that it gave us the answer <code>Bruce</code> simply because that’s the first answer it ran into.  If we were to swap the order of the rules for <code>Dog</code>, we would have looked for <code>Collie</code>s before <code>Labrador</code>s instead of the other way around, and so we would get the answer <code>lassie</code> instead.  Or alternatively, we could have added <code>[randomly]</code> to our rules.</p>




			</div>

		</div>

		<div class="col-md-3">

<div class="container-fluid sidebar">
			<h5>Simple logic programs</h5>
			<ol>
					<li><a class="backgroundlink" href="Predicates.html" id="section_page_1"> Predicates </a> <br></li>
					<li><a class="backgroundlink" href="Asking_questions.html" id="section_page_2"> Asking questions of predicates </a> <br></li>
					<li><a class="simplelink" href="Inference.html" id="section_page_3"> <b> Inference </b> </a> <br></li>
					<li><a class="backgroundlink" href="Magic.html" id="section_page_4"> Magic </a> <br></li>
					<li><a class="backgroundlink" href="Clairvoyance.html" id="section_page_5"> A deeper magic: clairvoyance </a> <br></li>
					<li><a class="backgroundlink" href="Under_the_hood.html" id="section_page_6"> Under the hood (technical) </a> <br></li>
			</ol>
	<script>
		document.addEventListener('keyup', function(e) {
			if (e.key >= '1' && e.key <= '9') document.getElementById('section_page_'+e.key).click()
		}, false);
	</script>
	</p>
	<br>
	<h5>Navigation: (click or use arrow keys)</h5>
	<p>
			<a class="simplelink" id="NextPage" href="Magic.html"><b>Next:</b> Magic</a><br>
			<script>
				document.addEventListener('keyup', function(e) { if (e.key == 'ArrowRight' || e.key == "Return") document.getElementById('NextPage').click()}, false);
			</script>
			<a class="simplelink" id="PreviousPage" href="Asking_questions.html"><b>Previous:</b> Asking questions of predicates</a><br>
			<script>
				document.addEventListener('keyup', function(e) { if (e.key == 'ArrowLeft') document.getElementById('PreviousPage').click()}, false);
			</script>
			<a class="simplelink" id="UpPage" href="Logic_programming.html"><b>Up:</b> Simple logic programs</a><br>
			<script>
				document.addEventListener('keyup', function(e) { if (e.key == 'ArrowUp') document.getElementById('UpPage').click()}, false);
			</script>
	</p>
</div>

		</div>
	</div>
</div>



<div class="container-fluid footer">
	<div class="container">
		<div class="row">
			<div class="col-10 col-lg-8 footer-contents">
				<div class="text-muted">
					<h4><a class="simplelink" href="index.html">Declarative Programming for Game Designers</a></h4>

					Copyright &copy; 2025 Ian Horswill
				</div>
				<div class="text-muted">
					<a href="https://github.com/rzubek/mies">Made by Booker, based on Rob Zubek's Mies (Crown Theme)</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	document.querySelectorAll('.language-step').forEach(e => {e.title = 'Click here to try the code'; });
</script>

<!-- this is required for bootstrap -->

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</body>
</html>



