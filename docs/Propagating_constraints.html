
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- generic metadata -->
	<title>Propagating constraints&#xA;</title>
	<meta name="author" content="Ian Horswill">
	<meta name="description" content="An introduction to declarative programming with applications to vidoegames">
	<meta name="generator" content="Booker">

	<!-- seo helpers: generic, twitter, facebook/opengraph -->
	<meta itemprop="name" content="Propagating constraints&#xA;">
	<meta name="twitter:title" content="Propagating constraints&#xA;">
	<meta property="og:title" content="Propagating constraints&#xA;" />
	<meta property="og:type" content="article" />
	<meta property="og:site_name" content="Declarative Programming for Game Designers" />
	
	<!-- stylesheets -->
	<!-- bootstrap needs to come first -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

	<!-- then our style sheet -->
	<link rel="stylesheet" href="site.css"> 

	<!-- sample fonts, please feel free to replace with your preferred ones -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Public+Sans:400,700&display=swap&subset=latin-ext"> 

	<!-- highlightjs is used for source code formatting inside <code> tags. feel free to remove it. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-dark.min.css">
	<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
	<script src="step.js"></script>
	<script src="NDScript.js"></script>
	<script>hljs.highlightAll();</script>
	
	<!-- use MathJax for latex rendering -->
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

	<!-- Use mermaid to render diagrams -->
	<script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
</head>

<body>
<div class="container-fluid shadow header">
	<div class="container">
		<div class="col-md-7 header-contents">
				<a class="backgroundlink" href="Part_I.html"> Part I
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Clairvoyant_programming.html"> Clairvoyant programming
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="NDScript.html"> Clairvoyant algorithms
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Map_generation.html"> Map generation
 </a>
			<h1><a id="linkToIndex" class="simplelink" href="index.html"> Propagating constraints
</a></h1>
					<p>
					<span style="padding:.25rem; padding-left:.5rem; padding-right:.5rem; background-color:orange; color:black;">
					   alpha test
					</span>
					</p>
		</div>
	</div>
</div>

	<!-- Make clicking On Step code pop up a step interpreter and copy the code into the clipboard -->
	<script>
	document.querySelector("body").addEventListener('click', function(e) {
		var element = e.target.closest('code');
		if(element !== null) {
			if (element.classList.contains('language-Step')) {
				var interp = window.open("https://ianhorswill.github.io/StepSandbox", "Step sandbox");
				var handler = function(e) { 
					interp.postMessage(element.textContent, "*");
					window.removeEventListener('message', handler);
				};
				window.addEventListener('message', handler);
			} else if (element.classList.contains('language-NDScript')) {
				var interp = window.open("https://ianhorswill.github.io/NDScriptSandbox", "NDScript sandbox");
				var handler = function(e) { 
					interp.postMessage(element.textContent, "*");
					window.removeEventListener('message', handler);
				};
				window.addEventListener('message', handler);
			}
		}
	}, false);
	</script>



<div class="container-fluid">
	<div class="row justify-content-center">
		<div class="col-md-7 index-contents">
			<div class="container shadow blog-contents">

<table class="centered">
<tr> <td width="auto"><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td> </tr>
</table>
<p>Now let's change the constraints somewhat.  Let's say that only another grass tile can be to the left of a grass tile.  Then if we place a grass tile on the right side:</p>
<table class="centered">
<tr> <td width="auto"><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="green255.png" alt="grass" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td> </tr>
</table>
<p>Then it not only removes water from consideration for its neighbors, as before:</p>
<table class="centered">
<tr> <td width="auto"><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td>
        <td><img src="green255.png" alt="grass" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
</table>
<p>But now it also forces the tile to the left to also be grass:</p>
<table class="centered">
<tr> <td width="auto"><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
         <td><img src="green255.png" alt="grass" width="auto"></td>
        <td><img src="green255.png" alt="grass" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
</table>
<p>That removes water from consideration for <em>its</em> neighbors:</p>
<table class="centered">
<tr> <td width="auto"><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> 
       <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
<tr> <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td>
         <td><img src="green255.png" alt="grass" width="auto"></td>
        <td><img src="green255.png" alt="grass" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> 
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
</table>
<p>But then the cell to the left of it also has to be grass:</p>
<table class="centered">
<tr> <td width="auto"><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
       <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> 
       <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
<tr> <td><img src="green255.png" alt="grass" width="auto"></td>
         <td><img src="green255.png" alt="grass" width="auto"></td>
        <td><img src="green255.png" alt="grass" width="auto"></td> </tr>
<tr> <td><img src="blue150.png" alt="sea" width="auto"><img src="green150.png" alt="grass" width="auto"><img src="brown150.png" alt="sand" width="auto"></td>
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> 
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
</table>
<p>which, again, restricts the cells above and below it:</p>
<table class="centered">
<tr> <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> 
       <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> 
       <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
<tr> <td><img src="green255.png" alt="grass" width="auto"></td>
         <td><img src="green255.png" alt="grass" width="auto"></td>
        <td><img src="green255.png" alt="grass" width="auto"></td> </tr>
<tr> <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> 
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> 
        <td><img src="green200.png" alt="grass" width="auto"><img src="brown200.png" alt="sand" width="auto"></td> </tr>
</table>
<p>So setting one tile impacted the tiles of <strong>every cell on the grid</strong> and fully determined the tile of two other cells.</p>
<h2 id="constraint-propagation">Constraint propagation</h2>
<p>This is called <strong>constraint propagation</strong>: as we narrow the choices of one cell, we update the choices of the neighboring cells.  This will never add new possibilities for the neighbors, but it can potentially remove them; when it does, we recursively update their neighbors, and so on, until no more cells can be narrowed.</p>
<p>There are two important possible outcomes for a cell.  If it is narrowed to a single possibility (aka a <strong>singleton</strong> set), then we know that cell has to have that tile.  On the other hand, if we remove all possibilities from a cell (we reduce it to the <strong>empty</strong> set), then we know that the choice that started the propagation process was incorrect, and we <code>fail</code>, meaning the solver has to reconsider one of the previous choices.</p>
<p>That's the basic algorithm for solving constraint satisfaction problems: start by allowing every cell to have every possible value.  Then gradually pick values for cells from among their possible values.  Each time, propagate that narrowing through the network of constraints, potentially narrowing the other cells.  If we narrow a cell to nothing, fail, if we're narrowed all cells to singletons, we're done.</p>


<table style="border: none; width: 100%; table-layout: fixed; margin-top: 2rem;">
<tbody>
<tr style="border: none;">
				<td style="border: none; vertical-align: top; "> 
                    <b>Previous:</b> 
					<a title="Click or press &#8592;" class="simplelink" id="PreviousPage" href="Tracking_sets_of_tiles.html">Tracking viable tiles
</a><br>
				</td>
				<td style="border: none; vertical-align: top; text-align: right;"> 
                    <b>Next:</b>  
					<a title="Click or press &#8594;" class="simplelink" id="NextPage" href="Writing_a_constraint_propagator.html">A clairvoyant map generator
</a><br>
				</td>			
</tr>
</tbody>
</table>
			</div>
		</div>

		<div class="col-md-3">

<div class="container-fluid sidebar">
		<h3 style="text-align: right;">Incomplete draft:<br>do not cite!</h3>
				<p style="color: grey; padding-bottom: 0rem; margin-bottom: 0rem;">Section 1.1.1.4.3</p>
			<h5>Map generation
</h5>
			<ol start="1">
					<li class="sidebar"><a class="backgroundlink" href="Early_checking.html" id="section_page_1"> Early checking
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Tracking_sets_of_tiles.html" id="section_page_2"> Tracking viable tiles
 </a> <br></li>
					<li class="sidebar"><a class="simplelink" href="Propagating_constraints.html" id="section_page_3"> <b> Propagating constraints
 </b> </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Writing_a_constraint_propagator.html" id="section_page_4"> A clairvoyant map generator
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="An_adjustable_version.html" id="section_page_5"> Adjusting the amounts of grass, sand, and water
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="WFC.html" id="section_page_6"> Constraint-based maps in the game industry
 </a> <br></li>
			</ol>
	<script>
		document.addEventListener('keyup', function(e) {
			if (e.key >= '1' && e.key <= '9') document.getElementById('section_page_'+e.key).click()
		}, false);
	</script>
	</p>
	<br>
	<h5>Navigation</h5>
	<p style="text-align: left;">
	<table style="border: none;">
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Next:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8594;" class="simplelink" id="NextPage" href="Writing_a_constraint_propagator.html">A clairvoyant map generator
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta") || e.getModifierState("Control")) return
					if (e.key == 'ArrowRight' || e.key == "Return")
					  document.getElementById('NextPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Previous:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8592;" class="simplelink" id="PreviousPage" href="Tracking_sets_of_tiles.html">Tracking viable tiles
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowLeft') 
						document.getElementById('PreviousPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Up:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8593;" class="simplelink" id="UpPage" href="Map_generation.html">Map generation
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowUp') document.getElementById(e.getModifierState("Control")?'linkToIndex':'UpPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"><b>Next &sect;:</b></td>
				<td style="border: none;"> 
					<a title="Click or press Control-&#8594;" class="simplelink" id="NextSectionPage" href="Clairvoyant_languages_in_real_life.html">Clairvoyant languages in real life
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowRight'  && e.getModifierState("Control")) document.getElementById('NextSectionPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"><b>Prev &sect;:</b></td>
				<td style="border: none;"> 
					<a title="Click or press Control-&#8592;" class="simplelink" id="PreviousSectionPage" href="Comparing_solutions.html">Least-cost paths
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowLeft'  && e.getModifierState("Control")) document.getElementById('PreviousSectionPage').click()
				}, false);
			</script>
	</table>
	</p>
	<div style="color: grey; padding-top: .5rem;">
		<a style="color: grey;" href="mailto:ian@northwestern.edu?subject=Comment on DPGD/Propagating_constraints.html">Send feedback on this page</a>
	</div>
</div>

		</div>
	</div>
</div>



<div class="container-fluid footer">
	<div class="container">
		<div class="row">
			<div class="col-10 col-lg-8 footer-contents">
				<div class="text-muted">
					<h4><a class="simplelink" href="index.html">Declarative Programming for Game Designers</a></h4>

					Copyright &copy; 2026 Ian Horswill
				</div>
				<div class="text-muted">
					<a href="https://github.com/rzubek/mies">Made by Booker, based on Rob Zubek's Mies (Crown Theme)</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	document.querySelectorAll('.language-step').forEach(e => {e.title = 'Click here to try the code'; });
</script>

<!-- this is required for bootstrap -->

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</body>
</html>
