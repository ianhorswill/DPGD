
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- generic metadata -->
	<title>Self-referential rules</title>
	<meta name="author" content="Ian Horswill">
	<meta name="description" content="An introduction to declarative programming with applications to vidoegames">
	<meta name="generator" content="Booker">

	<!-- seo helpers: generic, twitter, facebook/opengraph -->
	<meta itemprop="name" content="Self-referential rules">
	<meta name="twitter:title" content="Self-referential rules">
	<meta property="og:title" content="Self-referential rules" />
	<meta property="og:type" content="article" />
	<meta property="og:site_name" content="Declarative Programming for Game Designers" />
	
	<!-- stylesheets -->
	<!-- bootstrap needs to come first -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

	<!-- then our style sheet -->
	<link rel="stylesheet" href="site.css"> 

	<!-- sample fonts, please feel free to replace with your preferred ones -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Public+Sans:400,700&display=swap&subset=latin-ext"> 

	<!-- highlightjs is used for source code formatting inside <code> tags. feel free to remove it. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-dark.min.css">
	<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
	<script src="step.min.js"></script>
	<script>hljs.highlightAll();</script>
	
	<!-- use MathJax for latex rendering -->
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

	<!-- Use mermaid to render diagrams -->
	<script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
</head>

<body>
<div class="container-fluid shadow header">
	<h1 style="text-align: right;">Incomplete draft: do not cite!</h1>

	<div class="container">
		<div class="col-10 col-md-8 header-contents">
				<a class="backgroundlink" href="Part_I.html"> Part I </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Clairvoyant_programming.html"> Clairvoyant programming </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Logic_programming.html"> Simple logic programs </a>
			<h1><a class="simplelink" href="index.html">Self-referential rules</a></h1>
		</div>
	</div>
</div>

	<!-- Make clicking On Step code pop up a step interpreter and copy the code into the clipboard -->
	<script>
	document.querySelector("body").addEventListener('click', function(e) {
		var element = e.target.closest('code');
		if(element !== null && element.classList.contains('language-Step')) {
			var interp = window.open("https://ianhorswill.github.io/WebStep", "step");
			var handler = function(e) { 
				console.log(e.data);
				interp.postMessage(element.textContent, "*");
				window.removeEventListener('message', handler);
			};
			window.addEventListener('message', handler);
		}
	}, false);
	</script>



<div class="container-fluid">
	<div class="row justify-content-center">
		<div class="col-md-7 index-contents">

			<div class="container shadow blog-contents">

<p>So far, so good.  We can define the <code>Parent</code> relationship and then define most everything else in terms of that: grandparents and grandchildren, great-grandparents, siblings, etc. But what about ancestors?  An ancestor is your parent or grandparent or great-grandparent or great, great-grandparent, etc. We could write:</p>
<pre><code class="language-step">[predicate]
Ancestor ?c ?a: [Parent ?c ?a]
Ancestor ?c ?g: [Grandparent ?c ?g]
Ancestor ?c ?g: [Greatgrandparent ?c ?g]
Ancestor ?c ?g: [Greatgreatgrandparent ?c ?g]
</code></pre>
<p>And so on, forever.  But forever is a lot of typing.</p>
<p>What we can do instead, that doesn't involve literally typing for eternity, is to define an ancestor as either:</p>
<ul>
<li>Your parent, or</li>
<li>An ancestor of your parent.</li>
</ul>
<p>We can write that in Step using just two rules that do the equivalent work of an infinite number of rules:</p>
<pre><code class="language-step">[predicate]
Ancestor ?c ?p: [Parent ?c ?p]
Ancestor ?c ?a: [Parent ?c ?p] [Ancestor ?p ?a]
</code></pre>
<p>In mathematics, logic, and computer science, this is called a <strong>recursive</strong> definition, and when the <code>Ancestor</code> rule turns around and calls <code>Ancestor</code> again, that’s called <strong>recursion</strong>.</p>
<h2 id="how-to-write-a-recursive-definition">How to write a recursive definition</h2>
<p>Recursive definitions have a fairly standard format:</p>
<ul>
<li>They <strong>don't say <code>[randomly]</code></strong></li>
<li>They start with a rule that doesn’t recurse (doesn't call the predicate we're defining).  This is called a <strong>base case</strong>.  It notices when it can decide immediately without having to recurse.</li>
<li>Then there’s another rule called, unsurprisingly, the <strong>recursive case</strong>, that ends with a recursive call (a call to the predicate being defined).</li>
</ul>
<p>There are exceptions to all these rules.  But if you don't put the base case first or you put the recursive call early in the recursive case, it's possible for the program to run forever.  We'll discuss this in more detail when we talk about <a href="SLD_Resolution.html">how code gets executed</a>, but for now, just remember: base case first, recursive call last, and don't <code>[randomize]</code> a recursive task.</p>
<h2 id="taxonomies">Taxonomies</h2>
<p>Taxonomic relationships come up a lot in games.  Dogs and cats are kinds of animals, Collie and Labrador are kinds of dogs.  We can express those relationships using rules:</p>
<pre><code class="language-Step"># Try: [Animal ?x]
[predicate]
Animal ?a: [Dog ?a]
Animal ?a: [Cat ?a]

[predicate]
Dog ?d: [Labrador ?d]
Dog ?d: [Collie ?d]

[predicate]
Collie lassie.
[predicate]
Labrador bruce.
</code></pre>
<p>Now suppose we run <code>[Animal lassie]</code>, i.e. we ask “is Lassie an animal?”  The system will start by running the first <code>Animal</code> method, which will call <code>Dog</code> to check if Lassie is a dog.  It then tries the first Dog method, which calls <code>Labrador</code> to check if Lassie is a Labrador.  That fails, since Bruce is the only Labrador.  So the system abandons the first <code>Dog</code> method and tries the second, which says to call <code>Collie</code>.  That succeeds, meaning it’s verified Lassie is a collie.  That then means that the method it was running for <code>Dog</code>, which had called Collie, also succeeds.  So the system has verified Lassie is a dog.  That then means that the method for <code>Animal</code> succeeds, and so it’s verified that Lassie is an animal.</p>
<p>We could instead have run <code>[Animal ?x]</code>, meaning “who’s an animal?”  It would then have run the first <code>Animal</code> rule, as before, but now it’s running <code>[Dog ?x]</code> rather than <code>[Dog lassie]</code>.  Then it will again start with the first <code>Dog</code> rule, which runs <code>[Labrador ?x]</code>.  Where the <code>Labrador</code> call failed in the <code>Lassie</code> example, it succeeds here because its parameter is a variable with no value.  So the call to <code>Labrador</code> actually succeeds, and binds <code>?x</code> to <code>bruce</code> (i.e. it sets <code>?x</code> to be <code>bruce</code> now).  Since <code>Labrador</code> succeeded, the <code>Dog</code> rule succeeds, which means the <code>Animal</code> rule succeeds, but in this case, it returns the answer that <code>?x=bruce</code>, i.e. “Bruce is an animal.”</p>
<p>Note that it gave us the answer <code>Bruce</code> simply because that’s the first answer it ran into.  If we were to swap the order of the rules for <code>Dog</code>, we would have looked for <code>Collie</code>s before <code>Labrador</code>s instead of the other way around, and so we would get the answer <code>lassie</code> instead.  Or alternatively, we could have added <code>[randomly]</code> to our rules.</p>




			</div>

		</div>

		<div class="col-md-3">

<div class="container-fluid sidebar">
			<h5>Simple logic programs</h5>
			<ol start="1">
					<li><a class="backgroundlink" href="Predicates.html" id="section_page_1"> Predicates </a> <br></li>
					<li><a class="backgroundlink" href="Asking_questions.html" id="section_page_2"> Asking questions of predicates </a> <br></li>
					<li><a class="backgroundlink" href="Complex_questions.html" id="section_page_3"> Building complex questions </a> <br></li>
					<li><a class="backgroundlink" href="Inference.html" id="section_page_4"> Inference </a> <br></li>
					<li><a class="simplelink" href="Self-referential_rules.html" id="section_page_5"> <b> Self-referential rules </b> </a> <br></li>
			</ol>
	<script>
		document.addEventListener('keyup', function(e) {
			if (e.key >= '1' && e.key <= '9') document.getElementById('section_page_'+e.key).click()
		}, false);
	</script>
	</p>
	<br>
	<h5>Navigation: (click or use arrow keys)</h5>
	<p>
			<a class="simplelink" id="NextPage" href="SLD_Resolution.html"><b>Next:</b> Solving</a><br>
			<script>
				document.addEventListener('keyup', function(e) { if (e.key == 'ArrowRight' || e.key == "Return") document.getElementById('NextPage').click()}, false);
			</script>
			<a class="simplelink" id="PreviousPage" href="Inference.html"><b>Previous:</b> Inference</a><br>
			<script>
				document.addEventListener('keyup', function(e) { if (e.key == 'ArrowLeft') document.getElementById('PreviousPage').click()}, false);
			</script>
			<a class="simplelink" id="UpPage" href="Logic_programming.html"><b>Up:</b> Simple logic programs</a><br>
			<script>
				document.addEventListener('keyup', function(e) { if (e.key == 'ArrowUp') document.getElementById('UpPage').click()}, false);
			</script>
	</p>
</div>

		</div>
	</div>
</div>



<div class="container-fluid footer">
	<div class="container">
		<div class="row">
			<div class="col-10 col-lg-8 footer-contents">
				<div class="text-muted">
					<h4><a class="simplelink" href="index.html">Declarative Programming for Game Designers</a></h4>

					Copyright &copy; 2025 Ian Horswill
				</div>
				<div class="text-muted">
					<a href="https://github.com/rzubek/mies">Made by Booker, based on Rob Zubek's Mies (Crown Theme)</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	document.querySelectorAll('.language-step').forEach(e => {e.title = 'Click here to try the code'; });
</script>

<!-- this is required for bootstrap -->

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</body>
</html>



