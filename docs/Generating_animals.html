
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- generic metadata -->
	<title>Generating animals using constraint propagation&#xA;</title>
	<meta name="author" content="Ian Horswill">
	<meta name="description" content="An introduction to declarative programming with applications to vidoegames">
	<meta name="generator" content="Booker">

	<!-- seo helpers: generic, twitter, facebook/opengraph -->
	<meta itemprop="name" content="Generating animals using constraint propagation&#xA;">
	<meta name="twitter:title" content="Generating animals using constraint propagation&#xA;">
	<meta property="og:title" content="Generating animals using constraint propagation&#xA;" />
	<meta property="og:type" content="article" />
	<meta property="og:site_name" content="Declarative Programming for Game Designers" />
	
	<!-- stylesheets -->
	<!-- bootstrap needs to come first -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

	<!-- then our style sheet -->
	<link rel="stylesheet" href="site.css"> 

	<!-- sample fonts, please feel free to replace with your preferred ones -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Public+Sans:400,700&display=swap&subset=latin-ext"> 

	<!-- highlightjs is used for source code formatting inside <code> tags. feel free to remove it. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-dark.min.css">
	<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
	<script src="step.js"></script>
	<script src="NDScript.js"></script>
	<script>hljs.highlightAll();</script>
	
	<!-- use MathJax for latex rendering -->
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

	<!-- Use mermaid to render diagrams -->
	<script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
</head>

<body>
<div class="container-fluid shadow header">
	<div class="container">
		<div class="col-md-7 header-contents">
				<a class="backgroundlink" href="Part_I.html"> Part I
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Clairvoyant_programming.html"> Clairvoyant programming
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="NDScript.html"> Clairvoyant algorithms
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Map_generation.html"> Map generation
 </a>
			<h1><a id="linkToIndex" class="simplelink" href="index.html">Generating animals using constraint propagation
</a></h1>
					<p>
					<span style="padding:.25rem; padding-left:.5rem; padding-right:.5rem; background-color:orange; color:black;">
					   alpha test
					</span>
					</p>
		</div>
	</div>
</div>

	<!-- Make clicking On Step code pop up a step interpreter and copy the code into the clipboard -->
	<script>
	document.querySelector("body").addEventListener('click', function(e) {
		var element = e.target.closest('code');
		if(element !== null) {
			if (element.classList.contains('language-Step')) {
				var interp = window.open("https://ianhorswill.github.io/StepSandbox", "Step sandbox");
				var handler = function(e) { 
					interp.postMessage(element.textContent, "*");
					window.removeEventListener('message', handler);
				};
				window.addEventListener('message', handler);
			} else if (element.classList.contains('language-NDScript')) {
				var interp = window.open("https://ianhorswill.github.io/NDScriptSandbox", "NDScript sandbox");
				var handler = function(e) { 
					interp.postMessage(element.textContent, "*");
					window.removeEventListener('message', handler);
				};
				window.addEventListener('message', handler);
			}
		}
	}, false);
	</script>



<div class="container-fluid">
	<div class="row justify-content-center">
		<div class="col-md-7 index-contents">
			<div class="container shadow blog-contents">

<p>In <a href="Map_generation.html">map generation</a> we looked at how to generate tilemaps using constraint propagation.  Now, we'll use the same basic ideas to solve a different constraint problem: generating random animals.</p>
<h2 id="attributes">Attributes</h2>
<p>We'll describe our animals in terms of three attributes:</p>
<ul>
<li><em>Leg style</em>: quadruped, biped, fins, or none (i.e. snake-like)</li>
<li><em>Wing style</em>: wings or none</li>
<li><em>Family</em>: mammal, reptile, bird, fish, or alien</li>
</ul>
<p>We will represent one of our animals as an object with fields for each attribute: leg style, wing style, and family.  Since we'll be using constriant-propagation, we'll initialize each of these to be <strong>the set of all possible values for that attribute</strong>, then gradually narrow the sets until each only has a single value (i.e. it's a <em>singleton set</em>):</p>
<pre><code class="language-ndscript">var animal =  { 
    legStyle: setOf(&quot;quadruped&quot;, &quot;biped&quot;, &quot;fins&quot;, &quot;none&quot;),
    wingStyle: setOf(&quot;wings&quot;, &quot;none&quot;),
    family: setOf(&quot;mammal&quot;, &quot;reptile&quot;, &quot;bird&quot;, &quot;fish&quot;, &quot;alien&quot;)
};
</code></pre>
<h2 id="constraints">Constraints</h2>
<p>These attributes can't be chosen entirely independently.  Mammals don't have fins.  Fish don't have wings.  And while aliens might allow combinations that don't exist on earth, such as winged quadrupeds, some combinations don't make sense, such as snakes with wings.  So we'll represent this as a set of constraints between the variables:</p>
<pre class="mermaid">graph TB
    legStyle["legStyle"] -- compatibleStyles --> wingStyle["wingStyle"]
    legStyle -- validLegFor --> family["family"]
    wingStyle -- validWingFor --> family
</pre>
<p>The leg styles that are valid for a given family is given by the <code>validLegFor</code> relation.  mammals and reptiles can have most kinds of legs, but fish can only have fins or be snakes:</p>
<pre><code class="language-ndscript">var validLegFor = relation(
    [ &quot;quadruped&quot;, &quot;mammal&quot; ],
    [ &quot;quadruped&quot;, &quot;reptile&quot; ],
    [ &quot;quadruped&quot;, &quot;alien&quot; ],
    [ &quot;biped&quot;, &quot;mammal&quot; ],
    [ &quot;biped&quot;, &quot;reptile&quot; ], 
    [ &quot;biped&quot;, &quot;bird&quot; ], 
    [ &quot;biped&quot;, &quot;alien&quot; ], 
    [ &quot;none&quot;, &quot;reptile&quot; ], 
    [ &quot;none&quot;, &quot;fish&quot; ], 
    [ &quot;none&quot;, &quot;alien&quot; ], 
    [ &quot;fins&quot;, &quot;fish&quot; ],
    [ &quot;fins&quot;, &quot;alien&quot; ]
);
</code></pre>
<p>Wing styles are more restrictive.  Only birds and aliens can have wings:</p>
<pre><code class="language-ndscript">var validWingFor = relation(
    [ &quot;wings&quot;, &quot;bird&quot; ],
    [ &quot;wings&quot;, &quot;alien&quot; ],
    [ &quot;none&quot;, &quot;mammal&quot; ],
    [ &quot;none&quot;, &quot;reptile&quot; ],
    [ &quot;none&quot;, &quot;fish&quot; ],
    [ &quot;none&quot;, &quot;alien&quot; ]
);
</code></pre>
<p>And finally, there are a few combinations of wing/legs that don't work.  You can't have wings and fins at once, or wings on a snake (it would tip over):</p>
<pre><code class="language-ndscript">var compatibleStyles = relation(
    [ &quot;quadruped&quot;, &quot;wings&quot; ],
    [ &quot;quadruped&quot;, &quot;none&quot; ],
    [ &quot;biped&quot;, &quot;wings&quot; ],
    [ &quot;biped&quot;, &quot;none&quot; ],
    [ &quot;fins&quot;, &quot;none&quot; ],
    [ &quot;none&quot;, &quot;none&quot; ]
);
</code></pre>
<p>Finally, we have a table of constraints and the attributes they apply to:</p>
<pre><code class="language-ndscript">var constraints = [
    [ &quot;legStyle&quot;, validLegFor, &quot;family&quot; ],
    [ &quot;wingStyle&quot;, validWingFor, &quot;family&quot; ],
    [ &quot;legStyle&quot;, compatibleStyles, &quot;wingStyle&quot; ]
];
</code></pre>
<p>These say that:</p>
<ul>
<li><code>validLegFor</code> has to hold between <code>legStyle</code> on the left (first argument) and <code>family</code> on the right (second argument)</li>
<li><code>validWingFor</code> has to hold between <code>wingStyle</code> on the left and <code>family</code> on the right</li>
<li><code>compatibleStyles</code> has to hold between <code>legStyle</code> on the left and <code>wingStyle</code> on the right</li>
</ul>
<h2 id="writing-a-solver">Writing a solver</h2>
<p>Write a solver for this algorithm in NDScript.  We've included a code skeleton below.  You should use the basic constraint propagation technique discussed in class:</p>
<ul>
<li>Track the sets of possible values for each variable (attribute of the animal)</li>
<li>Initialize them all to their full sets of possibilities</li>
<li>Repeatedly choose an attribute and select its value from its remaining possibilities</li>
<li>Whenever you narrow a attribute A, use its constraints to narrow the attributes it's connected to
<ul>
<li>Find the image of A's set of possible values through the constraint's relation
<ul>
<li>If A is on the left in the constraint, use the right image, if it's on the right, use the left image</li>
</ul>
</li>
<li>Narrow the other variable to that set</li>
<li>Recursively narrow the variables connected to it, as needed</li>
</ul>
</li>
</ul>
<p>The simplest way to write it is to use the recursive formulation we used in class.  However, feel free to write it using a queue if you prefer.</p>
<p>As in JavaScript, compound objects such as <code>animal</code> behave both as record structures and as dictionaries.  So to find the current value of legStyle, you can say either <code>animal.legStyle</code> or <code>animal[&quot;legStyle&quot;]</code>.  For this assignment, the latter will be easier to use.  You can also update the object using assignment statements as usual, i.e. <code>animal.legStyle = newValue</code> or <code>animal[&quot;legStyle&quot;] = newValue</code>.</p>
<p>You will want to use some or all the following built-in functions for this:</p>
<ul>
<li>Accessing objects
<ul>
<li><code>nonsingletonFieldsOf(object)</code><br />
Returns the names of the fields of the compound object that are set to non-singleton sets.  Initially, <code>nonsingletonFieldsOf(animal)</code> = <code>[&quot;legStyle&quot;, &quot;wingStyle&quot;, &quot;family&quot;]</code>.</li>
</ul>
</li>
<li>Sets
<ul>
<li><code>setOf(value, ...)</code><br />
The set of the specified values</li>
<li><code>intersection(set, set)</code><br />
The set of elements common to both arguments.</li>
<li><code>isEmpty(collection)</code><br />
True if the collection has no elements</li>
</ul>
</li>
<li>Relations
<ul>
<li><code>leftImage(relation, set)</code>, <code>rightImage(relation, set)</code><br />
The image of the set under the relation.</li>
</ul>
</li>
<li>Old friends from the last assignment
<ul>
<li><code>chooseElement(collection)</code><br />
Non-deterministically chooses an element from the collection.</li>
<li><code>print(values, ...)</code>, <code>printLine(values, ...)</code><br />
Prints the specified values.  The results are &ldquo;unprinted&rdquo; if we backtrack.</li>
</ul>
</li>
</ul>
<p>Here is your starter code.  Fill in <code>solve()</code> and <code>narrowTo()</code>.  Helper functions aren't necessary, but feel free to use them if you like (I used one for my reference solution).</p>
<p>When you are finished, press the download button to save it to a file and upload the file to canvas.</p>
<pre><code class="language-NDScript">var animal =  { 
    legStyle: setOf(&quot;quadruped&quot;, &quot;biped&quot;, &quot;fins&quot;, &quot;none&quot;),
    wingStyle: setOf(&quot;wings&quot;, &quot;none&quot;),
    family: setOf(&quot;mammal&quot;, &quot;reptile&quot;, &quot;bird&quot;, &quot;fish&quot;, &quot;alien&quot;)
};

var validLegFor = relation(
    [ &quot;quadruped&quot;, &quot;mammal&quot; ],
    [ &quot;quadruped&quot;, &quot;reptile&quot; ],
    [ &quot;quadruped&quot;, &quot;alien&quot; ],
    [ &quot;biped&quot;, &quot;mammal&quot; ],
    [ &quot;biped&quot;, &quot;reptile&quot; ], 
    [ &quot;biped&quot;, &quot;bird&quot; ], 
    [ &quot;biped&quot;, &quot;alien&quot; ], 
    [ &quot;none&quot;, &quot;reptile&quot; ], 
    [ &quot;none&quot;, &quot;fish&quot; ], 
    [ &quot;none&quot;, &quot;alien&quot; ], 
    [ &quot;fins&quot;, &quot;fish&quot; ],
    [ &quot;fins&quot;, &quot;alien&quot; ]
);

var validWingFor = relation(
    [ &quot;wings&quot;, &quot;bird&quot; ],
    [ &quot;wings&quot;, &quot;alien&quot; ],
    [ &quot;none&quot;, &quot;mammal&quot; ],
    [ &quot;none&quot;, &quot;reptile&quot; ],
    [ &quot;none&quot;, &quot;fish&quot; ],
    [ &quot;none&quot;, &quot;alien&quot; ]
);

var compatibleStyles = relation(
    [ &quot;quadruped&quot;, &quot;wings&quot; ],
    [ &quot;quadruped&quot;, &quot;none&quot; ],
    [ &quot;biped&quot;, &quot;wings&quot; ],
    [ &quot;biped&quot;, &quot;none&quot; ],
    [ &quot;fins&quot;, &quot;none&quot; ],
    [ &quot;none&quot;, &quot;none&quot; ]
);

var constraints = [
    [ &quot;legStyle&quot;, validLegFor, &quot;family&quot; ],
    [ &quot;wingStyle&quot;, validWingFor, &quot;family&quot; ],
    [ &quot;legStyle&quot;, compatibleStyles, &quot;wingStyle&quot; ]
];

function solve() {
    // Fill me in
    // Repeatedly choose attributes of animal that aren't singleton sets, choose an element, and narrow it.

    print(animal);
}

deterministic function narrowTo(attribute, set) {
    // Fill me in
    // Remove from animal[attribute] any elements not in set.
    // Fail if the result is empty, propagate to other attributes as necessary.
}

solve();
</code></pre>


<table style="border: none; width: 100%; table-layout: fixed; margin-top: 2rem;">
<tbody>
<tr style="border: none;">
				<td style="border: none; vertical-align: top; "> 
                    <b>Previous:</b> 
					<a title="Click or press &#8592;" class="simplelink" id="PreviousPage" href="Map_generation.html">Map generation
</a><br>
				</td>
				<td style="border: none; vertical-align: top; text-align: right;"> 
                    <b>Next:</b>  
					<a title="Click or press &#8594;" class="simplelink" id="NextPage" href="Clairvoyant_languages_in_real_life.html">Clairvoyant languages in real life
</a><br>
				</td>			
</tr>
</tbody>
</table>
			</div>
		</div>

		<div class="col-md-3">

<div class="container-fluid sidebar">
		<h3 style="text-align: right;">Incomplete draft:<br>do not cite!</h3>
			<h5>Map generation
</h5>
			<ol start="1">
					<li class="sidebar"><a class="backgroundlink" href="Early_checking.html" id="section_page_1"> Early checking
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Tracking_sets_of_tiles.html" id="section_page_2"> Tracking viable tiles
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Propagating_constraints.html" id="section_page_3"> Propagating constraints
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Writing_a_constraint_propagator.html" id="section_page_4"> A clairvoyant map generator
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="An_adjustable_version.html" id="section_page_5"> Adjusting the amounts of grass, sand, and water
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="WFC.html" id="section_page_6"> Constraint-based maps in the game industry
 </a> <br></li>
			</ol>
	<script>
		document.addEventListener('keyup', function(e) {
			if (e.key >= '1' && e.key <= '9') document.getElementById('section_page_'+e.key).click()
		}, false);
	</script>
	</p>
	<br>
	<h5>Navigation</h5>
	<p style="text-align: left;">
	<table style="border: none;">
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Next:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8594;" class="simplelink" id="NextPage" href="Clairvoyant_languages_in_real_life.html">Clairvoyant languages in real life
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta") || e.getModifierState("Control")) return
					if (e.key == 'ArrowRight' || e.key == "Return")
					  document.getElementById('NextPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Previous:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8592;" class="simplelink" id="PreviousPage" href="Map_generation.html">Map generation
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowLeft') 
						document.getElementById('PreviousPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Up:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8593;" class="simplelink" id="UpPage" href="Map_generation.html">Map generation
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowUp') document.getElementById(e.getModifierState("Control")?'linkToIndex':'UpPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"><b>Next &sect;:</b></td>
				<td style="border: none;"> 
					<a title="Click or press Control-&#8594;" class="simplelink" id="NextSectionPage" href="Clairvoyant_languages_in_real_life.html">Clairvoyant languages in real life
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowRight'  && e.getModifierState("Control")) document.getElementById('NextSectionPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"><b>Prev &sect;:</b></td>
				<td style="border: none;"> 
					<a title="Click or press Control-&#8592;" class="simplelink" id="PreviousSectionPage" href="Comparing_solutions.html">Least-cost paths
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowLeft'  && e.getModifierState("Control")) document.getElementById('PreviousSectionPage').click()
				}, false);
			</script>
	</table>
	</p>
	<div style="color: grey; padding-top: .5rem;">
		<a style="color: grey;" href="mailto:ian@northwestern.edu?subject=Comment on DPGD/Generating_animals.html">Send feedback on this page</a>
	</div>
</div>

		</div>
	</div>
</div>



<div class="container-fluid footer">
	<div class="container">
		<div class="row">
			<div class="col-10 col-lg-8 footer-contents">
				<div class="text-muted">
					<h4><a class="simplelink" href="index.html">Declarative Programming for Game Designers</a></h4>

					Copyright &copy; 2025 Ian Horswill
				</div>
				<div class="text-muted">
					<a href="https://github.com/rzubek/mies">Made by Booker, based on Rob Zubek's Mies (Crown Theme)</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	document.querySelectorAll('.language-step').forEach(e => {e.title = 'Click here to try the code'; });
</script>

<!-- this is required for bootstrap -->

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</body>
</html>
