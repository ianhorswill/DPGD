
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- generic metadata -->
	<title>Tuning it&#xA;</title>
	<meta name="author" content="Ian Horswill">
	<meta name="description" content="An introduction to declarative programming with applications to vidoegames">
	<meta name="generator" content="Booker">

	<!-- seo helpers: generic, twitter, facebook/opengraph -->
	<meta itemprop="name" content="Adjusting the amounts of grass, sand, and water&#xA;">
	<meta name="twitter:title" content="Adjusting the amounts of grass, sand, and water&#xA;">
	<meta property="og:title" content="Adjusting the amounts of grass, sand, and water&#xA;" />
	<meta property="og:type" content="article" />
	<meta property="og:site_name" content="Declarative Programming for Game Designers" />
	
	<!-- stylesheets -->
	<!-- bootstrap needs to come first -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

	<!-- then our style sheet -->
	<link rel="stylesheet" href="site.css"> 

	<!-- sample fonts, please feel free to replace with your preferred ones -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Public+Sans:400,700&display=swap&subset=latin-ext"> 

	<!-- highlightjs is used for source code formatting inside <code> tags. feel free to remove it. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-dark.min.css">
	<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
	<script src="step.js"></script>
	<script src="NDScript.js"></script>
	<script>hljs.highlightAll();</script>
	
	<!-- use MathJax for latex rendering -->
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

	<!-- Use mermaid to render diagrams -->
	<script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
</head>

<body>
<div class="container-fluid shadow header">
	<div class="container">
		<div class="col-md-7 header-contents">
				<a class="backgroundlink" href="Part_I.html"> Part I
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Clairvoyant_programming.html"> Clairvoyant programming
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="NDScript.html"> Clairvoyant algorithms
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Map_generation.html"> Map generation
 </a>
			<h1><a id="linkToIndex" class="simplelink" href="index.html"> Adjusting the amounts of grass, sand, and water
</a></h1>
					<p>
					<span style="padding:.25rem; padding-left:.5rem; padding-right:.5rem; background-color:orange; color:black;">
					   alpha test
					</span>
					</p>
		</div>
	</div>
</div>

	<!-- Make clicking On Step code pop up a step interpreter and copy the code into the clipboard -->
	<script>
	document.querySelector("body").addEventListener('click', function(e) {
		var element = e.target.closest('code');
		if(element !== null) {
			if (element.classList.contains('language-Step')) {
				var interp = window.open("https://ianhorswill.github.io/StepSandbox", "Step sandbox");
				var handler = function(e) { 
					interp.postMessage(element.textContent, "*");
					window.removeEventListener('message', handler);
				};
				window.addEventListener('message', handler);
			} else if (element.classList.contains('language-NDScript')) {
				var interp = window.open("https://ianhorswill.github.io/NDScriptSandbox", "NDScript sandbox");
				var handler = function(e) { 
					interp.postMessage(element.textContent, "*");
					window.removeEventListener('message', handler);
				};
				window.addEventListener('message', handler);
			}
		}
	}, false);
	</script>



<div class="container-fluid">
	<div class="row justify-content-center">
		<div class="col-md-7 index-contents">
			<div class="container shadow blog-contents">

<p>You may have noticed that the version from the previous page tends to generate lots of long, thin bits of grass, water, and sand, rather than big blocks of grass and water.  That's because the choice loop is choosing tiles randomly.  On average, it will choose equal numbers of grass, water, and sand tiles.  The algorithm is then forced, in some sense, to find places to put all that sand.  That tends to break up chunks of grass or water.</p>
<p>We can fix this by telling it to try to use less sand and more grass and water.  The <code>chooseElement</code> function takes an optional argument giving weightings of the different allowable elements.  So we'll add a new variable, <code>weighting</code> specifying the ideal distribution of tile types (remember the sets like the names of the tiles, which are colors, rather than the names water, sand, and grass):</p>
<pre><code class="language-ndscript">var weighting = { green: 1, blue: 1, brown: 0.1 };
</code></pre>
<p>And then we just add it to our call for selecting a tile:</p>
<pre><code class="language-ndscript">narrowTo(p, setOf(chooseElement(g[p], weighting)));
</code></pre>
<p>It will still generate more brown (sand) tiles than the weighting would suggest because the constraints will force it to put a sand tile between any water and grass tiles, but this is still much better.</p>
<p>Give it a try:</p>
<pre><code class="language-NDScript">// Tiles: sand, grass, and water
var sand = &quot;brown&quot;;
var grass = &quot;green&quot;;
var water = &quot;blue&quot;;

// Weightings for frequency of choice of different kinds of tiles
var weighting = { green: 1, blue: 1, brown: 0.1 };

// 10x10 grid with each cell initialized to the set { sand, grass, water }
var g = makeGrid(10, 10, setOf(sand, grass, water));

// What tiles can be adjaccent to what other tiles.
// Any combination is allowed EXCEPT water next to grass.
// This forces there to be a sand tile between any pair of
// water and grass tiles.
var compatible = relation(
   [sand, grass], [sand, water], [sand, sand],
   [water, water], [water, sand],
   [grass, grass], [grass, sand]);

function solve() {
    var remaining = nonsingletonPositionsOf(g);
    while (!isEmpty(remaining)) {
      var p = chooseElement(remaining);
      narrowTo(p, setOf(chooseElement(g[p], weighting)));
      remaining = nonsingletonPositionsOf(g);
      // printTilesetMap(g, &quot;gray&quot;);
    }
}

// Restrict the tile at position to only tiles in the specified set
// If that removes candidate tiles, then update neighboring
// positions to only the tiles compatible with the new, limited
// candidate tiles for this position.
deterministic function narrowTo(position, restriction) {
  var old = g[position];
  var new = intersection(old, restriction);
  if (old != new) {
     g[position] = new;
     var neighborCompatible = rightImage(compatible, new);
     foreach (n in neighborsOf(position, g))
       narrowTo(n, neighborCompatible);
  }
}

solve();
printTilesetMap(g, &quot;gray&quot;);
</code></pre>


<table style="border: none; width: 100%; table-layout: fixed; margin-top: 2rem;">
<tbody>
<tr style="border: none;">
				<td style="border: none; vertical-align: top; "> 
                    <b>Previous:</b> 
					<a title="Click or press &#8592;" class="simplelink" id="PreviousPage" href="Writing_a_constraint_propagator.html">A clairvoyant map generator
</a><br>
				</td>
				<td style="border: none; vertical-align: top; text-align: right;"> 
                    <b>Next:</b>  
					<a title="Click or press &#8594;" class="simplelink" id="NextPage" href="WFC.html">Constraint-based maps in the game industry
</a><br>
				</td>			
</tr>
</tbody>
</table>
			</div>
		</div>

		<div class="col-md-3">

<div class="container-fluid sidebar">
		<h3 style="text-align: right;">Incomplete draft:<br>do not cite!</h3>
				<p style="color: grey; padding-bottom: 0rem; margin-bottom: 0rem;">Section 1.1.1.4.5</p>
			<h5>Map generation
</h5>
			<ol start="1">
					<li class="sidebar"><a class="backgroundlink" href="Early_checking.html" id="section_page_1"> Early checking
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Tracking_sets_of_tiles.html" id="section_page_2"> Tracking viable tiles
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Propagating_constraints.html" id="section_page_3"> Propagating constraints
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Writing_a_constraint_propagator.html" id="section_page_4"> A clairvoyant map generator
 </a> <br></li>
					<li class="sidebar"><a class="simplelink" href="An_adjustable_version.html" id="section_page_5"> <b> Adjusting the amounts of grass, sand, and water
 </b> </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="WFC.html" id="section_page_6"> Constraint-based maps in the game industry
 </a> <br></li>
			</ol>
	<script>
		document.addEventListener('keyup', function(e) {
			if (e.key >= '1' && e.key <= '9') document.getElementById('section_page_'+e.key).click()
		}, false);
	</script>
	</p>
	<br>
	<h5>Navigation</h5>
	<p style="text-align: left;">
	<table style="border: none;">
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Next:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8594;" class="simplelink" id="NextPage" href="WFC.html">Constraint-based maps in the game industry
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta") || e.getModifierState("Control")) return
					if (e.key == 'ArrowRight' || e.key == "Return")
					  document.getElementById('NextPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Previous:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8592;" class="simplelink" id="PreviousPage" href="Writing_a_constraint_propagator.html">A clairvoyant map generator
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowLeft') 
						document.getElementById('PreviousPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Up:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8593;" class="simplelink" id="UpPage" href="Map_generation.html">Map generation
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowUp') document.getElementById(e.getModifierState("Control")?'linkToIndex':'UpPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"><b>Next &sect;:</b></td>
				<td style="border: none;"> 
					<a title="Click or press Control-&#8594;" class="simplelink" id="NextSectionPage" href="Clairvoyant_languages_in_real_life.html">Clairvoyant languages in real life
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowRight'  && e.getModifierState("Control")) document.getElementById('NextSectionPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"><b>Prev &sect;:</b></td>
				<td style="border: none;"> 
					<a title="Click or press Control-&#8592;" class="simplelink" id="PreviousSectionPage" href="Comparing_solutions.html">Least-cost paths
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowLeft'  && e.getModifierState("Control")) document.getElementById('PreviousSectionPage').click()
				}, false);
			</script>
	</table>
	</p>
	<div style="color: grey; padding-top: .5rem;">
		<a style="color: grey;" href="mailto:ian@northwestern.edu?subject=Comment on DPGD/An_adjustable_version.html">Send feedback on this page</a>
	</div>
</div>

		</div>
	</div>
</div>



<div class="container-fluid footer">
	<div class="container">
		<div class="row">
			<div class="col-10 col-lg-8 footer-contents">
				<div class="text-muted">
					<h4><a class="simplelink" href="index.html">Declarative Programming for Game Designers</a></h4>

					Copyright &copy; 2025 Ian Horswill
				</div>
				<div class="text-muted">
					<a href="https://github.com/rzubek/mies">Made by Booker, based on Rob Zubek's Mies (Crown Theme)</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	document.querySelectorAll('.language-step').forEach(e => {e.title = 'Click here to try the code'; });
</script>

<!-- this is required for bootstrap -->

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</body>
</html>
