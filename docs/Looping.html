
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- generic metadata -->
	<title>Looping operations&#xA;</title>
	<meta name="author" content="Ian Horswill">
	<meta name="description" content="An introduction to declarative programming with applications to vidoegames">
	<meta name="generator" content="Booker">

	<!-- seo helpers: generic, twitter, facebook/opengraph -->
	<meta itemprop="name" content="Looping operations&#xA;">
	<meta name="twitter:title" content="Looping operations&#xA;">
	<meta property="og:title" content="Looping operations&#xA;" />
	<meta property="og:type" content="article" />
	<meta property="og:site_name" content="Declarative Programming for Game Designers" />
	
	<!-- stylesheets -->
	<!-- bootstrap needs to come first -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

	<!-- then our style sheet -->
	<link rel="stylesheet" href="site.css"> 

	<!-- sample fonts, please feel free to replace with your preferred ones -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Public+Sans:400,700&display=swap&subset=latin-ext"> 

	<!-- highlightjs is used for source code formatting inside <code> tags. feel free to remove it. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/atom-one-dark.min.css">
	<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
	<script src="step.js"></script>
	<script src="NDScript.js"></script>
	<script>hljs.highlightAll();</script>
	
	<!-- use MathJax for latex rendering -->
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

	<!-- Use mermaid to render diagrams -->
	<script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
</head>

<body>
<div class="container-fluid shadow header">
	<div class="container">
		<div class="col-md-7 header-contents">
				<a class="backgroundlink" href="Part_I.html"> Part I
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Clairvoyant_programming.html"> Clairvoyant programming
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="The_Step_language.html"> Step
 </a>
&nbsp;&#x25BB;&nbsp;				<a class="backgroundlink" href="Higher-order_tasks.html"> Higher-order tasks
 </a>
			<h1><a id="linkToIndex" class="simplelink" href="index.html">Looping operations
</a></h1>
					<p>
					<span style="padding:.25rem; padding-left:.5rem; padding-right:.5rem; background-color:orange; color:black;">
					   alpha test
					</span>
					</p>
		</div>
	</div>
</div>

	<!-- Make clicking On Step code pop up a step interpreter and copy the code into the clipboard -->
	<script>
	document.querySelector("body").addEventListener('click', function(e) {
		var element = e.target.closest('code');
		if(element !== null) {
			if (element.classList.contains('language-Step')) {
				var interp = window.open("https://ianhorswill.github.io/StepSandbox", "Step sandbox");
				var handler = function(e) { 
					interp.postMessage(element.textContent, "*");
					window.removeEventListener('message', handler);
				};
				window.addEventListener('message', handler);
			} else if (element.classList.contains('language-NDScript')) {
				var interp = window.open("https://ianhorswill.github.io/NDScriptSandbox", "NDScript sandbox");
				var handler = function(e) { 
					interp.postMessage(element.textContent, "*");
					window.removeEventListener('message', handler);
				};
				window.addEventListener('message', handler);
			}
		}
	}, false);
	</script>



<div class="container-fluid">
	<div class="row justify-content-center">
		<div class="col-md-7 index-contents">
			<div class="container shadow blog-contents">

<p>Again, the basic execution strategy of languages like Step makes it easy to ask questions about whether some execution path exists.  We can ask questions about all possible paths too, but we have to use higher-order tasks to do that.</p>
<h2 id="everyimplies"><code>Every</code>/<code>Implies</code></h2>
<p>We talked about <code>Every</code> <a href="Higher-order_tasks.html">earlier</a>.  The predicate:</p>
<pre><code class="language-step">[Every ?p ?q]
</code></pre>
<p>is so named because, if it's true, then it means <code>?q</code> is true in all situations where <code>?p</code> is true.  Or to put it another way, there are no situations where <code>?p</code> is true (i.e. no solutions to <code>?p</code>) where <code>?q</code> is false (where <code>?q</code> fails).  In fact, if it weren't built in, we could define <code>Every</code> ourselves:</p>
<pre><code class="language-step">Every ?p ?q: [Not [And ?p [Not ?q]]]
</code></pre>
<p><code>Every</code> is also called <code>Implies</code>, because there are some situations where that's a more natural reading of it's meaning.  Both variables are set to the same predicate; you can use whichever name best captures the intent of your code.</p>
<p>Under the hood, this is going to work by finding all solutions to <code>?p</code> and then for each one, testing if <code>?q</code> is true.  For example, if we use our food preferences example:</p>
<pre><code class="language-step">[predicate]
Likes tanya sushi.
Likes tanya burgers.
Likes tanya mexican.
Likes jayden burgers.
Likes jayden ethiopean.
# Kimiko likes everything
Likes kimiko ?.
# Everyone likes pizza.
Likes ? pizza.
</code></pre>
<p>we might ask &quot;does everyone who likes burgers like pizza?&quot;  That would be:</p>
<pre><code class="language-step">[Every [Likes ?who burgers] [Likes ?who pizza]]
</code></pre>
<p>You can try it out:</p>
<pre><code class="language-Step"># Try: [Every [Likes ?who burgers] [Likes ?who pizza]]
[predicate]
Likes tanya sushi.
Likes tanya burgers.
Likes tanya mexican.
Likes jayden burgers.
Likes jayden ethiopean.
# Kimiko likes everything
Likes kimiko ?.
# Everyone likes pizza.
Likes ? pizza.
</code></pre>
<p>You get the answer &ldquo;yes&rdquo;, but it doesn't have a binding for the variable <code>?who</code>.  That makes sense because we weren't asking for a specific person who liked burgers and pizza, we were asking if <em>everyone</em> who liked burgers liked pizza.  So there's no one <code>?who</code> to report back.</p>
<h2 id="why-is-there-no-any-task">Why is there no <code>Any</code> task?</h2>
<p>Since we can say <code>[Every [Likes ?who burgers] [Likes ?who pizza]]</code> to ask if everyone who likes burgers also likes pizza, we might think there would we could write <code>[Any [Likes ?who burgers] [Likes ?who pizza]]</code> to ask if anyone who likes burgers also likes pizza.  But we don't need a separate <code>Any</code> task; if we just run them in sequence:</p>
<pre><code class="language-step">[Likes ?who burgers] [Likes ?who pizza]
</code></pre>
<p>that has the same effect: it will find a <code>?who</code> who likes both burgers and pizza.</p>
<h2 id="foreach"><code>ForEach</code></h2>
<p><code>Every</code>/<code>Implies</code> is useful when calling predicates.  But what if we wanted to ask it to print everyone who liked burgers?  You could write it this way:</p>
<pre><code class="language-Step"># Try: [WhoEats burgers]
WhoEats ?x: [Implies [Likes ?who ?x] [Write ?who]]
[predicate]
Likes tanya sushi.
Likes tanya burgers.
Likes tanya mexican.
Likes jayden burgers.
Likes jayden ethiopean.
# Kimiko likes everything
Likes kimiko ?.
# Everyone likes pizza.
Likes ? pizza.
</code></pre>
<p>But it reads a little strangely to say &quot;implies Write.&quot;  Here it reads a little better to use <code>ForEach</code>:</p>
<pre><code class="language-Step"># Try: [WhoEats burgers]
WhoEats ?x: [ForEach [Likes ?who ?x] [Write ?who]]
[predicate]
Likes tanya sushi.
Likes tanya burgers.
Likes tanya mexican.
Likes jayden burgers.
Likes jayden ethiopean.
# Kimiko likes everything
Likes kimiko ?.
# Everyone likes pizza.
Likes ? pizza.
</code></pre>
<p>For these purposes, <code>ForEach</code> is identical to <code>Every</code>/<code>Implies</code>, it just has a more useful title.  However, there is one difference, which is that <code>[Implies ?p ?q]</code> will fail if <code>?q</code> ever fails when <code>Implies</code> calls it.  <code>ForEach</code> actually ignores whether <code>q</code> fails or not.</p>
<h2 id="state-updates-in-loops">State updates in loops</h2>
<p><code>[ForEach ?p ?q]</code> and <code>[Every ?p ?q]</code> will collect all the output generated by the different calls to <code>?q</code>.  It will also accumulate any changes to global variables or fluents that <code>?q</code> makes.  However, it will ignore any output or changes made by <code>?p</code>.</p>
<h2 id="niche-loops-ignore-this-if-you-arent-a-power-user">Niche loops (ignore this if you aren't a power-user)</h2>
<h3 id="doall">DoAll</h3>
<p><code>[Every ?p ?q]</code> and <code>[ForEach ?p ?q]</code> consider all the possible execution paths of <code>?p</code> but for each of those paths, only finds one solution of <code>?q</code>.  <code>DoAll</code> takes a series of calls, and finds <em>all</em> the solutions to the sequence and gives you all their outputs:</p>
<pre><code class="language-step">[DoAll ?call1 ?call2 ...]
</code></pre>
<p>Note that this only accumulates output; it ignores all state changes.</p>
<h2 id="accumulateoutputwithseparators">AccumulateOutputWithSeparators</h2>
<p>This is mostly used for printing comma-separated lists of things</p>
<pre><code class="language-step">[AccumulateOutputWithSeparators ?generator ?printer ?separator ?finalSeparator]
</code></pre>
<p>This is mostly like saying <code>[ForEach ?generator ?printer]</code> except rather than just printing the outputs of <code>?printer</code>, it separates them by <code>?separator</code>, putting <code>?finalSeparator</code> before the end.  If we use it for our <code>WhoEats</code> example:</p>
<pre><code class="language-Step"># Try: [WhoEats burgers]
WhoEats ?x: [AccumulateOutputWithSeparators [Likes ?who ?x] [WriteCapitalized ?who] &quot;,&quot; &quot;and&quot;]
[predicate]
Likes tanya sushi.
Likes tanya burgers.
Likes tanya mexican.
Likes jayden burgers.
Likes jayden ethiopean.
# Kimiko likes everything
Likes kimiko ?.
# Everyone likes pizza.
Likes ? pizza.
</code></pre>
<p>we get &ldquo;Tanya, Jayden and Kimiko&rdquo;, which looks a little nicer than if we just had spaced between them.</p>


<table style="border: none; width: 100%; table-layout: fixed; margin-top: 2rem;">
<tbody>
<tr style="border: none;">
				<td style="border: none; vertical-align: top; "> 
                    <b>Previous:</b> 
					<a title="Click or press &#8592;" class="simplelink" id="PreviousPage" href="Negation.html">Negation is (necessary) evil
</a><br>
				</td>
				<td style="border: none; vertical-align: top; text-align: right;"> 
                    <b>Next:</b>  
					<a title="Click or press &#8594;" class="simplelink" id="NextPage" href="All-solutions_predicates.html">All-solutions predicates
</a><br>
				</td>			
</tr>
</tbody>
</table>
			</div>
		</div>

		<div class="col-md-3">

<div class="container-fluid sidebar">
		<h3 style="text-align: right;">Incomplete draft:<br>do not cite!</h3>
			<h5>Higher-order tasks
</h5>
			<ol start="1">
					<li class="sidebar"><a class="backgroundlink" href="Calling_a_variable.html" id="section_page_1"> Running code in a variable
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Logical_connectives.html" id="section_page_2"> Ands and Ors
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Negation.html" id="section_page_3"> Negation is (necessary) evil
 </a> <br></li>
					<li class="sidebar"><a class="simplelink" href="Looping.html" id="section_page_4"> <b> Looping operations
 </b> </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="All-solutions_predicates.html" id="section_page_5"> All-solutions predicates
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Flow_control.html" id="section_page_6"> Other flow-control operations
 </a> <br></li>
					<li class="sidebar"><a class="backgroundlink" href="Parse_predicate.html" id="section_page_7"> Parsing
 </a> <br></li>
			</ol>
	<script>
		document.addEventListener('keyup', function(e) {
			if (e.key >= '1' && e.key <= '9') document.getElementById('section_page_'+e.key).click()
		}, false);
	</script>
	</p>
	<br>
	<h5>Navigation</h5>
	<p style="text-align: left;">
	<table style="border: none;">
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Next:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8594;" class="simplelink" id="NextPage" href="All-solutions_predicates.html">All-solutions predicates
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta") || e.getModifierState("Control")) return
					if (e.key == 'ArrowRight' || e.key == "Return")
					  document.getElementById('NextPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Previous:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8592;" class="simplelink" id="PreviousPage" href="Negation.html">Negation is (necessary) evil
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowLeft') 
						document.getElementById('PreviousPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"> <b>Up:</b> </td>
				<td style="border: none;"> 
					<a title="Click or press &#8593;" class="simplelink" id="UpPage" href="Higher-order_tasks.html">Higher-order tasks
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowUp') document.getElementById(e.getModifierState("Control")?'linkToIndex':'UpPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"><b>Next &sect;:</b></td>
				<td style="border: none;"> 
					<a title="Click or press Control-&#8594;" class="simplelink" id="NextSectionPage" href="Reflection.html">Reflection
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowRight'  && e.getModifierState("Control")) document.getElementById('NextSectionPage').click()
				}, false);
			</script>
			<tr style="border: none;">
				<td style="border: none; vertical-align: top;"><b>Prev &sect;:</b></td>
				<td style="border: none;"> 
					<a title="Click or press Control-&#8592;" class="simplelink" id="PreviousSectionPage" href="Primitive_tasks.html">Primitive tasks (technical)
</a><br>
				</td>
			</tr>
			<script>
				document.addEventListener('keyup', function(e) {
					if (e.getModifierState("Meta")) return
					if (e.key == 'ArrowLeft'  && e.getModifierState("Control")) document.getElementById('PreviousSectionPage').click()
				}, false);
			</script>
	</table>
	</p>
	<div style="color: grey; padding-top: .5rem;">
		<a style="color: grey;" href="mailto:ian@northwestern.edu?subject=Comment on DPGD/Looping.html">Send feedback on this page</a>
	</div>
</div>

		</div>
	</div>
</div>



<div class="container-fluid footer">
	<div class="container">
		<div class="row">
			<div class="col-10 col-lg-8 footer-contents">
				<div class="text-muted">
					<h4><a class="simplelink" href="index.html">Declarative Programming for Game Designers</a></h4>

					Copyright &copy; 2025 Ian Horswill
				</div>
				<div class="text-muted">
					<a href="https://github.com/rzubek/mies">Made by Booker, based on Rob Zubek's Mies (Crown Theme)</a>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	document.querySelectorAll('.language-step').forEach(e => {e.title = 'Click here to try the code'; });
</script>

<!-- this is required for bootstrap -->

<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</body>
</html>
